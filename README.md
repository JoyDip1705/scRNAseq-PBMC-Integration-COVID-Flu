# scRNA-seq Analysis of PBMCs: COVID-19 vs. Flu vs. Healthy
This repository contains an R-based scRNA-seq analysis pipeline for comparing Peripheral Blood Mononuclear Cells (PBMCs) from COVID-19, Influenza, and Healthy donors. The primary challenge addressed in this analysis is the presence of significant batch effects between different samples.

The workflow uses the Seurat package to perform data integration based on the SCTransform normalization method. This approach corrects for technical variability between samples, allowing for a more accurate comparison of cell populations and gene expression across the different disease conditions.

Analysis Workflow ðŸ§¬

The analysis is performed in a sequential R script, following these key steps:

   1. Setup and Data Loading:
        â€¢ Loads necessary libraries (Seurat, SingleR, tidyverse, etc.).
        â€¢ Reads 10X Genomics count data using Read10X.
        â€¢ Creates an initial Seurat object.

   2. Metadata Annotation:
        â€¢ Maps sample-specific barcode suffixes (e.g., "-1", "-2") to meaningful sample names (e.g., "nCoV1", "Flu1", "Normal1").
        â€¢ Assigns a "condition" (COVID, Flu, Healthy) to each cell based on its sample origin.
        â€¢ Subsets the full dataset to a smaller, representative group of samples for this analysis (nCoV1, nCoV2, Flu1, Flu2, Normal1, Normal2).

   3. Quality Control (QC) and Filtering:
        â€¢ Calculates the percentage of mitochondrial genes (percent.mt) for each cell.
        â€¢ Visualizes pre-filtering QC metrics (nCount_RNA, nFeature_RNA, percent.mt) using VlnPlot.
        â€¢ Filters out low-quality cells and potential doublets based on feature counts and mitochondrial percentage.
        â€¢ Filtering criteria: nFeature_RNA > 200, nFeature_RNA < 5000, percent.mt < 10.

   4. Pre-Integration Analysis (Visualizing Batch Effects):
        â€¢ Runs standard normalization (SCTransform), PCA (RunPCA), and t-SNE (RunTSNE) on the un-integrated data.
        â€¢ Generates t-SNE plots showing cells colored by sample and condition.
        â€¢ Result: These plots (see below) clearly show that cells cluster primarily by their sample of origin, not by biological cell type, demonstrating a strong batch effect.

   5. Integration and Batch Effect Correction:
        â€¢ Splits the Seurat object into a list of objects, one for each sample using SplitObject.
        â€¢ Re-runs SCTransform on each individual sample.
        â€¢ Uses SelectIntegrationFeatures, PrepSCTIntegration, and FindIntegrationAnchors (with reduction = "cca") to identify common anchors across all samples.
        â€¢ Integrates the datasets using IntegrateData to create a single, batch-corrected Seurat object.

   6. Post-Integration Analysis:
        â€¢ Sets the default assay to the new integrated assay.
        â€¢ Runs PCA, t-SNE, and clustering (FindNeighbors, FindClusters) on the corrected data.
        â€¢ Result: New t-SNE plots show that cells from different samples and conditions are now well-mixed, indicating the batch effect has been successfully removed.

   7. Cell Type Identification:
        â€¢ Finds conserved cluster markers using FindAllMarkers on the SCT assay.
        â€¢ Performs automated cell type annotation using SingleR and the HumanPrimaryCellAtlasData reference from the celldex package.
        â€¢ Renames the Seurat clusters based on the dominant SingleR cell type annotation for each cluster (e.g., "T-cells", "Monocytes", "B-cells").

   8. Final Visualization:
        â€¢ Generates a final, annotated t-SNE plot showing the identified cell types.
        â€¢ Produces violin plots for key marker genes (e.g., CD3D, MS4A1, CD14) to confirm annotations.

Key Visualizations ðŸ“Š

1. Before Integration (Batch Effect)

These plots show the t-SNE visualization of the data before batch effect correction. Cells are clearly separated by their sample of origin and condition, not by their underlying biology.

(Generated by plot1 and plot2 in the script)

2. After Integration (Batch Effect Corrected)

These plots show the t-SNE after integration. Cells from different samples and conditions are now mixed, forming clusters based on biological cell type.

(Generated by plot3 and plot4 in the script)

3. Final Annotated Cell Types

This is the final t-SNE plot, where clusters are labeled with their identified cell types based on marker genes and SingleR annotation.

(Generated by the final DimPlot after RenameIdents)
